<main class="container my-2 py-2">
  <div class="row">
    <div class="col-12 mt-1 ml-2 auctioned-items dashboard-card" style="height: 655px;">
      <h1>Bids</h1>
      <% if @items.any? %>
        <ul class="list-group">
          <% @items.each do |item| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <%= item.name %>
              <span class="badge bg-danger rounded-pill">
                <% item.bids.each do |bid| %>
                  <div>
                    <%= bid.user.first_name %> <%= "\t" %>
                    <%= link_to "Accept", accept_bid_item_path(item, bid_id: bid.id), method: :patch, class: "btn btn-sm btn-success me-1" %>
                    <%= link_to "Decline", decline_bid_item_path(item, bid_id: bid.id), method: :patch, class: "btn btn-sm btn-danger" %>
                  </div>
                <% end %>
              </span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No items with bids found.</p>
      <% end %>
    </div>
    <div class="col-12">
      <div class="row">
        <div class="col-5 m-1 dashboard-card justify-content-center">
          <div class="col-12 m-1 justify-content-center" style="height: 300px;">
            <div class="chart" style="height: 100%;">
              <canvas id="Overview" class=""></canvas>
            </div>
          </div>
        </div>
        <div class="col-5 m-1 dashboard-card justify-content-center">
          <div class="col-12 m-1 justify-content-center" style="height: 305px;">
            <div class="chart" style="height: 100%;">
              <canvas id="religiousCommunitiesChart" class=""></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-9 m-1 dashboard-card">
          <div id="line" class="col-9 justify-content-center" style="height: 255px;">
            <div class="line-chart" style="height: 100%">
              <canvas id="earningsChart" class=""></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const overviewCtx = document.getElementById('Overview').getContext('2d');
    const overview = new Chart(overviewCtx, {
      type: 'doughnut',
      data: {
        labels: ['Sold', 'Bought', 'Views'],
        datasets: [{
          data: [<%= @sold_items.count %>, <%= @bought_items_count %>, <%= @views_count %>],
          backgroundColor: ['#36A2EB', '#FF6384', '#F0ECA2'],
          hoverBackgroundColor: ['#36A2EB', '#FF6384', '#F0ECA2']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'left',
          },
          title: {
            display: true,
            text: 'Overview'
          }
        }
      }
    });

    const earningsCtx = document.getElementById('earningsChart').getContext('2d');
    const earningsChart = new Chart(earningsCtx, {
      type: 'line',
      data: {
        labels: <%= @earnings_over_time.map { |e| e[:month] }.to_json.html_safe %>,
        datasets: [{
          label: 'Earnings',
          data: <%= @earnings_over_time.map { |e| e[:earnings] }.to_json.html_safe %>,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'left',
          },
          title: {
            display: true,
            text: 'Earnings Over Time'
          }
        }
      }
    });

    const religiousCommunitiesCtx = document.getElementById('religiousCommunitiesChart').getContext('2d');
    const religiousCommunitiesChart = new Chart(religiousCommunitiesCtx, {
      type: 'polarArea',
      data: {
        labels: ['Tops', 'Bottoms', 'Accessories'],
        datasets: [{
          data: [32, 24, 15],
          backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
          hoverBackgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'left',
          },
          title: {
            display: true,
            text: 'Items Sold/Bought'
          }
        }
      }
    });
  });
</script>
